@model Project.Data.ViewModel.ShoppingCartVm

@{
    ViewData["Title"] = "Shopping Cart";
}

<h2 class="text-light mb-4">🛒 Your Shopping Cart</h2>

@if (!Model.ShoppingCartItems.Any())
{
    <p class="text-light">Your shopping cart is empty.</p>
    <a class="btn btn-primary" href="@Url.Action("Index", "Movies")">Continue Shopping</a>
}
else
{
    <div class="row g-4">
        @foreach (var item in Model.ShoppingCartItems)
        {
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card bg-dark text-white shadow-sm h-100 cart-card">

                    <img src="@item.Movie.ImageURL"
                         class="card-img-top"
                         style="height: 250px; object-fit: cover; border-radius: 10px;" />

                    <div class="card-body d-flex flex-column">

                        <h5 class="card-title">@item.Movie.Name</h5>

                        <p class="mb-1"><strong>Category:</strong> @item.Movie.MovieCategory</p>
                        <p class="mb-1 text-info"><strong>Price:</strong> $@item.Price</p>
                        <p class="mb-1 text-bg-primary"><strong>Quantity:</strong> @item.Quantity</p>
                        <p class="mb-1 text-warning">
                            <strong>Total:</strong> $@(item.Price* item.Quantity)
                        </p>

                        <div class="mt-auto d-flex justify-content-between">
                            <a class="btn btn-danger btn-sm"
                               href="@Url.Action("RemoveShoppingCart", "Order", new { id = item.Movie.Id })">
                                <i class="bi bi-trash"></i> Remove
                            </a>

                            <form asp-action="AddShoppingCart" asp-controller="Order" method="post">
                                <input type="hidden" name="id" value="@item.Movie.Id" />
                                <button type="submit" class="btn btn-primary btn-sm">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
        }
    </div>

    <!-- TOTAL + PAYPAL -->
    <div class="mt-4">
        <h4>
            Total:
            <span class="text-warning">$@Model.ShoppingCartTotal</span>
        </h4>

        <!-- PayPal Button -->
        <div id="paypal-button-container" class="my-3"></div>

        <a class="btn btn-primary" href="@Url.Action("Index", "Movies")">
            Continue Shopping
        </a>
    </div>
}

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=AWKabDDOtSRZxE8W4ChvcFdUk9QNOh_PsKmV5wJjRRw3QYEcz3NuLq1Y_oFigNhuTvHCXO3VLp_FN2zQ&currency=USD"></script>

<script>
    paypal.Buttons({
        createOrder: function (data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '@Model.ShoppingCartTotal'
                    }
                }]
            });
        },
        onApprove: function (data, actions) {
            return actions.order.capture().then(function (details) {
                // بعد الدفع
                window.location.href = '/Order/CompleteOrder';
            });
        }
    }).render('#paypal-button-container');
</script>
